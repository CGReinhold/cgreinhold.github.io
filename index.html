<!DOCTYPE html>
<html>
<head>
  <script src="./CGRCode.js"></script>
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <meta charset="utf-8" />
  <style>
    body {
      background-color: #454545;
      color: white;
    }
    header {
      padding: 50px 50px 0 50px;
      margin: 0 20px 0 20px;
    }
    .main {
      height: 100%;
      width: 100%;
      display: flex;
      flex-direction: row;
      padding: 50px;
      color: #4D4D4D;
    }
    .form {
      flex: 1;
      max-width: 800px;
      padding: 20px;
      margin: 20px;
      background-color: white;
      border-radius: 10px;
    }
    .salvar {
      border: 2px solid #DDD;
      color: #DDD;
      padding: 5px;
      display: flex;
      margin: 0px 20px 0px 20px;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .styling {
      border-radius: 4px;
    }
    .form-group {
      margin: 5px;
    }
    .group-collapse {
      margin-bottom: 8px;
    }
    .group-head {
      cursor: pointer;
      display: flex;
      padding: 5px;
      color: #4D4D4D;
      font-size: 14px;
      font-weight: 700;
      border-bottom: 1px solid #CCC;
      position: relative;
      -webkit-transition: all 0.4s ease;
      -o-transition: all 0.4s ease;
      transition: all 0.4s ease;
      align-items: center;
      justify-content: space-between;
    }
    .group-content {
      display: none;
    }
    @media only screen and (max-width: 700px) {
      .main {
        display: block;
        padding: 10px;
      }
    }
  </style>
</head>
<body onload="pageLoad()" onresize="render()">
  <header>
    <h1>
      CGR Code
    </h1>
  </header>
  <div class="main">
    <div class="imagem">
      <div id="canvas" class="canvas"></div>
      <div class="salvar" onclick="save()">Save as png</div>
    </div>
    <div class="form">
      <form>
        <div class="form-group">
          <label for="text">Text:</label>
          <input class="form-control form-control-sm" id="text" type="text" value="test" oninput="render()" />
        </div>
        <div class="styling">
          <div class="group-collapse">
            <div class="group-head" onclick="expandAccordion(this)">
              <h5>Style</h5>
              <i class="fa fa-chevron-down"></i>
            </div>
            <div class="group-content">
              <div class="form-group">
                <label for="shape">Shape</label>
                <select class="form-control form-control-sm" id="shape" onchange="render()">
                  <option value="square">Square</option>
                  <option value="circle">Circle</option>
                  <option value="triangle">Triangle</option>
                </select>
              </div>
              <div class="form-group">
                <label for="symbols">Symbols</label>
                <select class="form-control form-control-sm" id="symbols" onchange="render()">
                  <option value="squares">Squares</option>
                  <option value="circles">Circles</option>
                  <option value="triangles">Triangles</option>
                </select>
              </div>
              <div class="form-group">
                <label for="symbolHeight">Size of the symbols:</label>
                <input class="form-control form-control-sm" id="symbolHeight" type="range" min="1" max="500" value="25" oninput="render()" />
              </div>
              <div class="form-group">
                <label for="symbolWidth">Width of the symbols:</label>
                <input class="form-control form-control-sm" id="symbolWidth" type="range" min="1" max="20" value="4" oninput="render()" />
              </div>
              <div class="form-group">
                <label for="symbolMargin">Margin of the symbols:</label>
                <input class="form-control form-control-sm" id="symbolMargin" type="range" min="1" max="500" value="35" onchange="render()" />
              </div>
              <div class="form-group">
                <label for="marginY">External margin Y:</label>
                <input class="form-control form-control-sm" id="marginY" type="range" min="1" max="1000" value="60" oninput="render()" />
              </div>
              <div class="form-group">
                <label for="marginX">External margin X:</label>
                <input class="form-control form-control-sm" id="marginX" type="range" min="1" max="1000" value="73" oninput="render()" />
              </div>
              <div class="form-group">
                <label for="rotation">Rotation:</label>
                <input class="form-control form-control-sm" id="rotation" type="range" min="-360" max="360" value="0" oninput="render()" />
              </div>
            </div>
          </div>
          <div class="group-collapse">
            <div class="group-head" onclick="expandAccordion(this)">
              <h5>Colors</h5>
              <i class="fa fa-chevron-down"></i>
            </div>
            <div class="group-content">
              <div class="form-group">
                <label for="color">Color of the symbols:</label>
                <input class="form-control form-control-sm" id="color" type="color" value="#231F20" onchange="render()" />
              </div>
              <div class="form-group">
                <label for="backgroundColor">Background color:</label>
                <input class="form-control form-control-sm" id="backgroundColor" type="color" value="#ffffff" onchange="render()" />
              </div>
            </div>
          </div>
          <div class="group-collapse">
            <div class="group-head" onclick="expandAccordion(this)">
              <h5>Image</h5>
              <i class="fa fa-chevron-down"></i>
            </div>
            <div class="group-content">
              <div class="form-group">
                <label for="image">Image URL:</label>
                <input class="form-control form-control-sm" id="image" type="text" value="https://images.ctfassets.net/2d5q1td6cyxq/2SqLXL2zJmcUUI2QSkUCy6/71701594cb1fdf6f2e60d34297262d6b/square.01.jpg" onchange="renderImage()" />
              </div>
              <div class="form-group">
                <label for="imageSource">Image:</label>
                <input class="form-control form-control-sm" id="imageSource" type="file" accept="image/*" />
              </div>
              <div class="form-group">
                <label for="imageXMargin">Image margin X:</label>
                <input class="form-control form-control-sm" id="imageXMargin" type="range" min="-200" max="1000" value="-1" onchange="render()" />
              </div>
              <div class="form-group">
                <label for="imageYMargin">Image margin Y:</label>
                <input class="form-control form-control-sm" id="imageYMargin" type="range" min="-200" max="1000" value="-1" onchange="render()" />
              </div>
              <div class="form-group">
                <label for="imageWidth">Image width:</label>
                <input class="form-control form-control-sm" id="imageWidth" type="range" min="10" max="1000" value="450" onchange="render()" />
              </div>
              <div class="form-group">
                <label for="imageHeight">Image height:</label>
                <input class="form-control form-control-sm" id="imageHeight" type="range" min="10" max="1000" value="450" onchange="render()" />
              </div>
              <div class="form-group">
                <label for="imageRotation">Image rotation:</label>
                <input class="form-control form-control-sm" id="imageRotation" type="range" min="-360" max="360" value="0" onchange="render()" />
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
  <script>
    var loadedImage = '';

    function expandAccordion(element) {
      const panel = element.nextElementSibling;
      const estaAtivo = panel.classList.contains('active');

      const actives = document.getElementsByClassName('active');
      if (actives && actives.length) {
        for (let i = 0; i < actives.length; i++) {
          actives[i].style.display = 'none';
          actives[i].classList.remove('active');
        }
      }

      if (panel && !estaAtivo) {
        panel.classList.add('active');
        panel.style.display = 'block';
      }
    }

    function renderImageSource(e) {
      var reader = new FileReader();
      reader.onload = function(event) {
        loadedImage = event.target.result; 
        document.getElementById('image').value = '';
        render();
      }
      reader.readAsDataURL(e.target.files[0]);
    }

    function pageLoad() {
      render();

      var imageLoader = document.getElementById('imageSource');
      imageLoader.addEventListener('change', renderImageSource, false);
    }

    function renderImage() {
      loadedImage = document.getElementById('image').value;
      render();
    }

    function render() {
      const height = screen.width > 600 ? 450 : screen.width - 60;
      const differenceHeight = screen.width > 600 ? 1 : ((100 - ((height * 100) / 350)) / 100) * 3;

      const text = document.getElementById('text').value;
      const marginX = Number(document.getElementById('marginY').value) * differenceHeight;
      const marginY = Number(document.getElementById('marginX').value) * differenceHeight;
      const rotation = Number(document.getElementById('rotation').value);
      const color = document.getElementById('color').value;
      const backgroundColor = document.getElementById('backgroundColor').value;
      const symbols = document.getElementById('symbols').value;
      const shape = document.getElementById('shape').value;
      const symbolWidth = Number(document.getElementById('symbolWidth').value);
      const symbolHeight = Number(document.getElementById('symbolHeight').value) * differenceHeight;
      const symbolMargin = Number(document.getElementById('symbolMargin').value) * differenceHeight;
      const imageXMargin = Number(document.getElementById('imageXMargin').value) * differenceHeight;
      const imageYMargin = Number(document.getElementById('imageYMargin').value) * differenceHeight;
      const imageWidth = Number(document.getElementById('imageWidth').value) * differenceHeight;
      const imageHeight = Number(document.getElementById('imageHeight').value) * differenceHeight;
      const imageRotation = Number(document.getElementById('imageRotation').value);
      const image = loadedImage || document.getElementById('image').value;

      const code = new CGRCode({ 
        text,
        height,
        marginX,
        marginY,
        rotation,
        color,
        backgroundColor,
        symbols,
        shape,
        symbolWidth,
        symbolHeight,
        symbolMargin,
        image: image,
        imageXMargin,
        imageYMargin,
        imageWidth,
        imageHeight,
        imageRotation,
        style: 'border-radius: 10px; margin: 20px;'
      });
      code.generate('canvas');
      this.code = code;
    }

    function save() {
      this.code.save();
    }
  </script>
</body>
</html>
